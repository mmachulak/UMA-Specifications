<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>User-Managed Access (UMA) Core Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="User-Managed Access (UMA) Core Protocol">
<meta name="generator" content="xml2rfc v1.36 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">T. Hardjono, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">MIT</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">C. Scholz</td></tr>
<tr><td class="header">Expires: December 30, 2011</td><td class="header">COM.lounge GmbH</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Bryan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">pbryan.net</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Machulak</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Newcastle University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Maler</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">XMLgrrl.com</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 28, 2011</td></tr>
</table></td></tr></table>
<h1><br />User-Managed Access (UMA) Core Protocol<br />draft-uma-core-v1-00-Rev12</h1>

<h3>Abstract</h3>

<p>This specification defines the User-Managed Access (UMA) core protocol. This protocol provides a method for users to control access to their protected resources, residing on any number of host sites, through an authorization manager that makes access decisions based on user policy.
</p>
<p>This document is a draft Report of the User-Managed Access Work Group of the Kantara Initiative. The User-Managed Access Work Group operates under Kantara IPR Policy - Option Patent and Copyright: Reciprocal Royalty Free with Opt-Out to Reasonable And Non discriminatory (RAND) and the publication of this document is governed by the policies outlined in this option.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on December 30, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Notational Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Endpoint Names<br />
<a href="#protecting-a-resource">2.</a>&nbsp;
Protecting a Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.</a>&nbsp;
Host Looks Up AM Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#am-endpoints">2.1.1.</a>&nbsp;
AM Endpoints<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.1.2.</a>&nbsp;
Example AM Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.2.</a>&nbsp;
Host Registers with AM<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.3.</a>&nbsp;
Host Obtains Host Access Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.4.</a>&nbsp;
Host Registers Sets of Resources to Be Protected<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resource-reg-example">2.4.1.</a>&nbsp;
Example of Registering Resource Sets<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#action-desc">2.4.2.</a>&nbsp;
Scope Descriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#resource-set-desc">2.4.3.</a>&nbsp;
Resource Set Descriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reg-api">2.4.4.</a>&nbsp;
Resource Registration API<br />
<a href="#getting-authz-accessing-resource">3.</a>&nbsp;
Getting Authorization and Accessing a Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-h-attempt-access">3.1.</a>&nbsp;
Requester-Host: Attempt Access at Protected Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ambiguous-user">3.1.1.</a>&nbsp;
Requester's Request Is Ambiguous<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#no-token">3.1.2.</a>&nbsp;
Requester Presents No Access Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.1.3.</a>&nbsp;
Requester Presents an Invalid Access Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#insufficient-scope">3.1.4.</a>&nbsp;
Requester's Token Has Insufficient Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sufficient-scope">3.1.5.</a>&nbsp;
Requester's Token Has Sufficient Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-am-obtain-token">3.2.</a>&nbsp;
Requester-AM: Requester Obtains Access Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#h-am-token-validation">3.3.</a>&nbsp;
Host-AM: Validate Requester's Presented Access Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#token-invalid">3.3.1.</a>&nbsp;
AM Returns a Token Invalid Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#token-valid">3.3.2.</a>&nbsp;
AM Returns a Token Valid Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#h-am-register-scope">3.4.</a>&nbsp;
Host-AM: Register a Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#r-am-authz-scope">3.5.</a>&nbsp;
Requester-AM: Request Authorization for Scoped Permission<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#trusted-claims">3.5.1.</a>&nbsp;
Trusted Claims<br />
<a href="#anchor11">4.</a>&nbsp;
Error Messages<br />
<a href="#anchor12">5.</a>&nbsp;
Security Considerations<br />
<a href="#anchor13">6.</a>&nbsp;
Privacy Considerations<br />
<a href="#anchor14">7.</a>&nbsp;
Conformance<br />
<a href="#IANA">8.</a>&nbsp;
IANA Considerations<br />
<a href="#Acknowledgments">9.</a>&nbsp;
Acknowledgments<br />
<a href="#anchor15">10.</a>&nbsp;
Issues<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#History">Appendix&nbsp;A.</a>&nbsp;
Document History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The User-Managed Access (UMA) core protocol provides a method based on <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a> (currently draft 16) for users to control access to their protected resources, residing on any number of host sites, through a single authorization manager (AM) that makes access decisions based on user policy.
</p>
<p>There are numerous use cases for UMA, where a resource owner nominates a third party to control access to these resources potentially without the real-time presence of the resource owner. A typical example is the following. A web user (authorizing user) can authorize a web app (requester) to gain one-time or ongoing access to a resource containing his home address stored at a "personal data store" service (host), by telling the host to act on access decisions made by his authorization decision-making service (authorization manager or AM). The requesting party might be an e-commerce company whose site is acting on behalf of the user himself to assist him/her in arranging for shipping a purchased item, or it might be his friend who is using an online address book service to collect addresses, or it might be a survey company that uses an online service to compile population demographics. Other scenarios and use cases for UMA usage can be found in (<a class='info' href='#UMA-usecases'>[UMA&#8209;usecases]<span> (</span><span class='info'>Maler, E., &ldquo;UMA Scenarios and Use Cases,&rdquo; 2011.</span><span>)</span></a>) and <a class='info' href='#UMA-userstories'>[UMA&#8209;userstories]<span> (</span><span class='info'>Maler, E., &ldquo;UMA User Stories,&rdquo; 2010.</span><span>)</span></a>.
</p>
<p>In enterprise settings, application access management often involves letting back-office applications serve only as policy enforcement points (PEPs), depending entirely on access decisions coming from a central policy decision point (PDP) to govern the access they give to requesters. This separation eases auditing and allows policy administration to scale in several dimensions. UMA makes use of a separation similar to this, letting the authorizing user serve as a policy administrator crafting authorization strategies on his or her own behalf.
</p>
<p>The UMA protocol profiles and extends <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a>. An AM serves as an enhanced OAuth authorization server; a host serves as an enhanced resource server; and a requester serves as an enhanced client, acquiring an access token and the requisite authorization to access a protected resource at the host.
</p>
<p>UMA also defines an interoperable protection API between the AM and host, allowing them to reside in separate domains and allowing the host to establish mutual trust with an AM on behalf of a particular user. This API is itself OAuth-protected. Thus, the overall UMA flow has a second embedded OAuth-based interaction within it governing the host-AM relationship.
</p>
<p>The UMA protocol has three broad phases (see <a class='info' href='#UMA-phases'>Figure&nbsp;1</a>).
</p><br /><hr class="insert" />
<a name="UMA-phases"></a>

<p style='text-align: center'>The Three Phases of the UMA Protocol
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>                                   +-----+----------------+
                                   | UA  |  authorizing   |
               +-------Manage (A)--|     |      user      |
               |                   +-----+----------------+
               |   Phase 1:              |       UA       |
               |   protect a             +----------------+
               |   resource                      |
               |                            Control (B)
               |                                 |
               v                                 v
        +-----------+              +-----+----------------+
        |   host    |&lt;-Protect-(C)-|prot | authorization  |
        |           |              | API |  manager (AM)  |
        +-----------+              +-----+----------------+
        | protected |                    | authorization  |
        | resource  |                    |      API       |
        +-----------+                    +----------------+
               ^                                 |
               |   Phases 2 and 3:         Authorize (D)
               |   get authz and                 |
               |   access a resource             v
               |                         +----------------+
               +-------Access (E)--------|   requester    |
                                         +----------------+
                                         (requesting party)</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The phases work as follows: </p>
<ol class="text">
<li>Protect a resource: This phase involves the authorizing user, host, and AM. The authorizing user has chosen to use a host for managing online resources ("A"), and introduces this host to an AM using an OAuth-mediated interaction that results in the AM giving the host an access token. The host uses AM's protection interface to tell the AM what sets of resources to protect ("C"). Out of band of the UMA protocol, the authorizing user instructs the AM what policies to attach to the registered resource sets ("B"). This phase is described in <a class='info' href='#protecting-a-resource'>Section&nbsp;2<span> (</span><span class='info'>Protecting a Resource</span><span>)</span></a>.
</li>
<li>Get authorization: This phase involves the requester, host, and AM. It may also involve synchronous involvement by the authorizing user if this person is synonymous with the requesting party. This phase is dominated by a loop of activity in which the requester approaches the host seeking access to a protected resource ("E"), is sent to obtain an access token from the AM if it does not have one, and then must demonstrate to the AM that it satisfies the user's authorization policy governing the sought-for resource and scope of access if the host discovers that it does not have the requisite authorization ("D"). This phase is described in <a class='info' href='#getting-authz-accessing-resource'>Section&nbsp;3<span> (</span><span class='info'>Getting Authorization and Accessing a Resource</span><span>)</span></a>.
</li>
<li>Access a resource: This phase involves the requester successfully presenting an access token that has sufficient permission associated with it to the host in order to gain access to the desired resource ("E"). This phase is described along with Phase 2 in <a class='info' href='#getting-authz-accessing-resource'>Section&nbsp;3<span> (</span><span class='info'>Getting Authorization and Accessing a Resource</span><span>)</span></a>.
</li>
</ol>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Notational Conventions</h3>

<p>The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>Unless otherwise noted, all the protocol parameter names and values are case sensitive.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p></p>
<blockquote class="text"><dl>
<dt>authorizing user</dt>
<dd>An UMA-defined variant of an OAuth resource owner; a web user who configures an authorization manager with policies that control how it makes access decisions when a requester attempts to access a protected resource at a host.
</dd>
<dt>authorization manager (AM)</dt>
<dd>An UMA-defined variant of an OAuth authorization server that carries out an authorizing user's policies governing access to a protected resource.
</dd>
<dt>protected resource</dt>
<dd>An access-restricted resource at a host, which is being policy-protected by the AM.
</dd>
<dt>host</dt>
<dd>An UMA-defined variant of an OAuth resource server that enforces access to the protected resources it hosts, as decided by an authorization manager.
</dd>
<dt>host access token</dt>
<dd>An access token representing the authorizing user's consent for a host to trust a particular authorization manager for access decisions about resources hosted there.
</dd>
<dt>claim</dt>
<dd>A statement of the value or values of one or more identity attributes of a requesting party. Claims are conveyed by a requester on behalf of a requesting party to an authorization manager in an attempt to satisfy an authorizing user's policy.
</dd>
<dt>requester</dt>
<dd>An UMA-defined variant of an OAuth client that seeks access to a protected resource.
</dd>
<dt>requester access token</dt>
<dd>An access token that can be associated with the authorizing user's authorization for a requester's access to particular resources at a host on behalf of a particular requesting party.
</dd>
<dt>requesting party</dt>
<dd>A web user, or a corporation or other legal person, that uses a requester to seek access to a protected resource.
</dd>
<dt>resource set description</dt>
<dd>A JSON-formatted document that represents a set of one or more resources to be AM-protected and maps possible scopes to them. The host registers a resource set by giving this document to the AM.
</dd>
<dt>scope description</dt>
<dd>A JSON-formatted document that represents a scope of access on a particular resource set. The host refers to this type of document from within resource set descriptions.
</dd>
<dt>token status description</dt>
<dd>A JSON-formatted document that represents the currently authorized scopes associated with a requester access token.
</dd>
<dt>permission</dt>
<dd>A scope of access over a particular resource set at a particular host that is being asked for by a requester or that has been granted by an AM.
</dd>
</dl></blockquote>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Endpoint Names</h3>

<p></p>
<blockquote class="text"><dl>
<dt>host access token endpoint</dt>
<dd>Part of the protection API at the AM used by the host (and part of standard OAuth). The endpoint at the AM at which the host asks for a host access token on the authorizing user's behalf.
</dd>
<dt>host user authorization endpoint</dt>
<dd>Part of the protection API at the AM used by the host (and part of standard OAuth). The endpoint at the AM to which the host redirects the authorizing user to authorize the host to use this AM for protecting resources, if the authorization code flow is being used.
</dd>
<dt>host registration endpoint</dt>
<dd>Part of the protection API at the AM used by the host. The endpoint at the AM at which the host registers both resource sets which the AM needs to protect and also permissions that a requester will be asking for. (ISSUE #34: One endpoint or two for registration?)
</dd>
<dt>token validation endpoint</dt>
<dd>Part of the protection API at the AM used by the host. The endpoint at the AM at which the host submits requester access tokens to be validated by the AM.
</dd>
<dt>protected resource endpoint</dt>
<dd>An endpoint at the host at which a requester accesses resources. This can be a singular API endpoint, one of a set of API endpoints, a URI corresponding to an HTML document, or any other Web-accessible URI.
</dd>
<dt>requester access token endpoint</dt>
<dd>Part of the authorization API at the AM used by the requester (and part of standard OAuth). The endpoint at the AM at which the requester asks for a requester access token.
</dd>
<dt>permission endpoint</dt>
<dd>Part of the authorization API at the AM used by the requester. The endpoint at the AM at which the requester asks for access permissions to be associated with its requester access token.
</dd>
</dl></blockquote>

<a name="protecting-a-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protecting a Resource</h3>

<p>Phase 1 of UMA is protecting a resource. For a host to be able to delegate authorization of protected-resource access to an AM, the authorizing user must first introduce the host to the AM. This phase is concluded successfuly when: </p>
<ul class="text">
<li>The host has received metadata about the AM, such as OAuth endpoints.
</li>
<li>The host has received an OAuth host access token that represents the authorizing user's approval for the host to work with the AM in protecting resources. This host access token is used when the host makes requests at the AM's protection interface.
</li>
<li>The AM has acquired information about resource sets on the host it is supposed to protect on behalf of the User.
</li>
</ul>

<p>The user, host, and AM perform the following steps in order to successfully complete Phase 1: </p>
<ol class="text">
<li>The host looks up the AM's metadata and learns about its protection API endpoints and supported formats.
</li>
<li>If the host has not yet obtained an OAuth client identifier and optional secret from the AM, it registers with the AM dynamically as required, for example via the UMA dynamic registration protocol (see <a class='info' href='#Dyn-Reg'>Dyn-Reg<span> (</span><span class='info'>Scholz, C., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; 2010.</span><span>)</span></a> [Dyn&#8209;Reg]).
</li>
<li>The host obtains a host access token from the AM with the authorizing user's consent, using either the authorization code grant type or of the SAML bearer assertion grant type.
</li>
<li>The host optionally registers scopes with the AM that are intended to be protected (see <a class='info' href='#reg-api'>Section&nbsp;2.4.4<span> (</span><span class='info'>Resource Registration API</span><span>)</span></a>).
</li>
</ol>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Host Looks Up AM Metadata</h3>

<p>The host needs to learn the OAuth- and UMA-related endpoints of the AM before they can begin interacting. The authorizing user might provide the AM's location to get the host started in this process, for example by typing a URL into a web form field or clicking a button. Alternatively, the host might already be configured to work with a single AM without requiring any user input. The exact process is beyond the scope of this specification, and it is up to the host to choose a method to learn the AM's location.
</p>
<p>From the data provided, discovered, or configured, the host MUST retrieve the hostmeta document as described in Section 2 of <a class='info' href='#hostmeta'>hostmeta<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;Web Host Metadata,&rdquo; 2010.</span><span>)</span></a> [hostmeta]. For example, if the user supplied "am.example.com" as the Authorization Manager's domain, the host creates the URL "https://am.example.com/.well-known/host-meta" and performs a GET request on it.
</p>
<a name="am-endpoints"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
AM Endpoints</h3>

<p>The AM MUST provide an XRD 1.0 formatted document at the hostmeta location, documenting the following: </p>
<ul class="text">
<li>A set of protection API endpoints for the host to use
</li>
<li>A set of authorization API endpoints for requesters to use
</li>
<li>At least one access token format the AM produces
</li>
<li>Any claim formats the AM supports
</li>
</ul>

<p>(Note that the method of endpoint discovery defined here is intended to be compatible with the ultimate dynamic discovery, registration, and binding solution proposed by the OAuth group. The UMA group has proposed a generic solution at <a class='info' href='#Dyn-Reg'>[Dyn&#8209;Reg]<span> (</span><span class='info'>Scholz, C., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; 2010.</span><span>)</span></a>, with which this discovery step is compatible.)
</p>
<p>Property type values for access token and claim format information: </p>
<blockquote class="text"><dl>
<dt>http://kantarainitiative.org/confluence/display/uma/token_formats</dt>
<dd>REQUIRED (one or more). Access token format produced by this AM. Currently the only option is "artifact".
</dd>
<dt>http://kantarainitiative.org/confluence/display/uma/claim_formats</dt>
<dd>OPTIONAL (zero or more). Claim format supported by this AM. Currently the options are "openid-connect" and (ISSUE#17: any others? fill in).
</dd>
</dl></blockquote>

<p>Link relationship rel values for the protection API endpoints for the host to use: </p>
<blockquote class="text"><dl>
<dt>http://kantarainitiative.org/confluence/display/uma/host_token_uri</dt>
<dd>REQUIRED. The host access token endpoint. Available HTTP methods are as defined by OAuth for a token issuance endpoint. Supplies the endpoint the host should use to ask for a host access token.
</dd>
<dt>http://kantarainitiative.org/confluence/display/uma/host_user_uri</dt>
<dd>REQUIRED. The host user authorization endpoint. Available HTTP methods are as defined by OAuth for an end-user authorization endpoint. Supplies the endpoint the host should use to gather the consent of the authorizing user for a host-AM relationship if it is using the authorization code grant type. The AM MUST support the authorization code grant type method of obtaining the authorizing user's consent. (ISSUE #28.)
</dd>
<dt>http://kantarainitiative.org/confluence/display/uma/host_reg_uri</dt>
<dd>REQUIRED. The host registration endpoint. Supports the POST HTTP method, accompanied by a host access token. Supplies the endpoint the host should use for registering information with the AM, such as descriptions of resource sets that are to be protected by this AM (see <a class='info' href='#reg-api'>Section&nbsp;2.4.4<span> (</span><span class='info'>Resource Registration API</span><span>)</span></a>) and permissions requesters are seeking (see <a class='info' href='#h-am-register-scope'>Section&nbsp;3.4<span> (</span><span class='info'>Host-AM: Register a Permission</span><span>)</span></a>). The AM SHOULD require the use of a transport-layer security mechanism such as TLS when the host sends requests to the host registration endpoint. (ISSUE #34: One endpoint or two for registration?)
</dd>
<dt>http://kantarainitiative.org/confluence/display/uma/host_token_val_uri</dt>
<dd>OPTIONAL. The host token validation endpoint. Supports the POST HTTP method, accompanied by a host access token. Supplies the endpoint the host should use to request validation of access tokens presented to them by requesters. This endpoint SHOULD require the use of a transport-layer security mechanism such as TLS.
</dd>
</dl></blockquote>

<p>Link relationship rel values for the authorization API endpoints for the requester to use: </p>
<blockquote class="text"><dl>
<dt>http://kantarainitiative.org/confluence/display/uma/req_token_uri</dt>
<dd>REQUIRED. The requester access token endpoint. Available HTTP methods are as defined by <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a> for a token issuance URL. Supplies the token URL requesters should use to ask for an access token in step 2. This endpoint SHOULD require the use of a transport-layer security mechanism such as TLS.
</dd>
<dt>http://kantarainitiative.org/confluence/display/uma/req_authz_uri</dt>
<dd> REQUIRED. Supplies the authroization URL requesters should use to ask for authorization to grant a scope. This endpoint SHOULD require the use of a transport-layer security mechanism such as TLS.
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Example AM Metadata</h3>

<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!-- Applies to both hosts and requesters --&gt;
&lt;Property
  type="http://wguma.org/confluence/display/uma/token_formats"&gt;
  saml
&lt;/Property&gt;
&lt;Property
  type="http://wguma.org/confluence/display/uma/claim_formats"&gt;
  json
&lt;/Property&gt;

&lt;!-- Host protection API --&gt;
&lt;Link
  rel="http://wguma.org/confluence/display/uma/host_token_uri"
  href="https://am.example.com/host/token_uri"&gt;&lt;/Link&gt;
&lt;Link
  rel="http://wguma.org/confluence/display/uma/host_user_uri"
  href="https://am.example.com/host/user_uri"&gt;&lt;/Link&gt;
&lt;Link rel="http://kantarainitiative.org/confluence/display/uma/host_reg_uri"
  href="https://am.example.com/host/resource_details_uri"&gt;&lt;/Link&gt;
&lt;Link
  rel="http://wguma.org/confluence/display/uma/host_token_val_uri"
  href="https://am.example.com/host/token_validation_uri"&gt;&lt;/Link&gt;

&lt;!-- Requester token-getting endpoints --&gt;
&lt;Link rel="http://wguma.org/confluence/display/uma/req_token_uri"
  href="https://am.example.com/requester/token_uri"&gt;&lt;/Link&gt;
&lt;Link rel="http://wguma.org/confluence/display/uma/req_authz_uri"
  href="https://am.example.com/requester/authz_uri"&gt;&lt;/Link&gt;
</pre></div>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Host Registers with AM</h3>

<p>If the host has not already obtained a client identifier and optional secret from this AM previously, in this step it MUST do so in order to engage in OAuth-based interactions with the AM. This MAY be done using the UMA dynamic registration protocol (see <a class='info' href='#Dyn-Reg'>Dyn-Reg<span> (</span><span class='info'>Scholz, C., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; 2010.</span><span>)</span></a> [Dyn&#8209;Reg]).
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Host Obtains Host Access Token</h3>

<p>In this step, the host acquires a host access token from the AM that represents the approval of the authorizing user for the host to trust the AM for protecting resources belonging to the user.
</p>
<p>The host MUST use the <a class='info' href='#OAuth2'>OAuth2<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a> [OAuth2] authorization code grant type or the SAML bearer token grant type <a class='info' href='#OAuth-SAML'>[OAuth&#8209;SAML]<span> (</span><span class='info'>Campbell, B., &ldquo;SAML 2.0 Bearer Assertion Grant Type Profile for OAuth 2.0,&rdquo; February&nbsp;2011.</span><span>)</span></a>, utilizing the end-user authorization and token endpoints as appropriate. Here the host acts in the role of an OAuth client. The authorizing user acts in the role of an OAuth end-user resource owner. The AM, through the provided endpoint URLs, acts in the role of an OAuth authorization server.
</p>
<p>The host has completed this step successfully when it possesses a host access token it can use at the AM's protection API.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Host Registers Sets of Resources to Be Protected</h3>

<p>Once the host has received a host access token, for any of the user's sets of resources that are to be protected by this AM, it MUST register these resource sets at the AM's registration endpoint.
</p>
<p>Note that the host is free to offer the option to protect any subset of the user's resources using different AMs or other means entirely, or to protect some resources and not others. Additionally, the choice of protection regimes can be made explicitly by the user or implicitly by the host. Any such partitioning by the host or user is outside the scope of this specification.
</p>
<a name="resource-reg-example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
Example of Registering Resource Sets</h3>

<p>The following example illustrates the intent and usage of resource set registration.
</p>
<p>This example contains some steps that are exclusively in the realm of user experience rather than web protocol, to achieve realistic illustration; these steps are labeled "User experience only". Some other steps are exclusively internal to the operation of the entity being discussed; these are labeled "Internal only".
</p>
<p>An authorizing user, Alice Adams, has just uploaded a photo of her new puppy to a host, Photoz.example.com, and wants to ensure that this specific photo is not publicly accessible.
</p>
<p>Alice has already introduced this host to her AM, CopMonkey.example.com, and thus Photoz has already obtained a host access token from CopMonkey. However, Alice has not previously instructed Photoz to use CopMonkey to protect any other photos of hers.
</p>
<p>Alice has previously visited CopMonkey to map a default "do not share with anyone" policy to any resource sets registered by Photoz, until such time as she maps some other less-draconian policies to those resources. (User experience only. This may have been done at the time Alice introduced the host to the AM, and/or it could have been a global or host-specific preference setting. A different constraint or no constraint at all might be associated with newly protected resources.) Other kinds of policies she may eventually map to particular photos or albums might be "Share only with husband@email.example.net" or "Share only with people in my 'family' group".
</p>
<p>Photoz itself has a publicly documented API that offers two dozen different methods that apply to single photos, such as "addTags" and "getSizes", but rolls them up into two photo-related scopes of access: "viewing" (consisting of varous read-only operations) and "all" (consisting of various reading, editing, and printing operations). It defines two Web-accessible JSON-encoded documents called scope descriptions that represent these scopes, which it is able to reuse for all of its users (not just Alice). The "name" parameter values are intended to be seen by Alice when she maps authorization constraints to specific resource sets and actions while visiting CopMonkey, such that Alice would see the strings "View Photo and Related Info" and "All Actions", likely accompanied by the referenced icons, in the CopMonkey interface. (Other users of Photoz might similarly see the same labels at CopMonkey or whatever other AM they use.)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
        "scope":
            {
            "_id": "view"
            "name": "View Photo and Related Info",
            "icon_uri": "http://www.example.com/icons/reading-glasses"
        }
}</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
        "scope":
            {
            "_id": "all"
            "name": "All Actions",
            "icon_uri": "http://www.example.com/icons/galaxy"
        }
}</pre></div>
<p>While visiting Photoz, Alice selects a link or button that instructs the site to "Protect" or "Share" this single photo (user experience only; Photoz could have made this a default or preference setting).
</p>
<p>As a result, Photoz defines for itself a resource set that represents this photo (internal only; Photoz is the only application that knows how to map a particular photo to a particular resource set). Photoz also prepares the following resource set description, which is specific to Alice and her photo. The "name" parameter value is intended to be seen by Alice in mapping authorization constraints to specific resource sets and actions when she visits CopMonkey, such that Alice would see the string "Steve the puppy!", likely accompanied by the referenced icon, in the CopMonkey interface. The possible scopes of access on this resource set are indicated with URI references to the action descriptions, as defined just above.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
        "resource_set":
            {
            "_id": "112210f47de98100"
            "name": "Steve the puppy!",
            "icon_uri": "http://www.example.com/icons/flower",
            "scopes":
                        ["http://photoz.example.com/dev/scopes/view",
                        "http://photoz.example.com/dev/scopes/all"]
        }
}</pre></div>
<p>Photoz uses the "create resource set description" method of CopMonkey's standard UMA-based resource registration API, presenting its Alice-specific host access token there, to register and assign an identifier to the resource set description. The resource set identifier path component of the URL matches the "_id" parameter value in the description.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PUT /host/photoz.example.com/resource/112210f47de98100
Content-Type: application/json
...

{
        "resource_set":
           {
           "_id": "112210f47de98100"
           "name": "Steve the puppy!",
           "icon_uri": "http://www.example.com/icons/flower",
           "scopes":
                        ["http://photoz.example.com/dev/scopes/view",
                        "http://photoz.example.com/dev/scopes/all"]
         }
}</pre></div>
<p>Once this description has been successfully registered, Photoz is responsible for responding to requesters' attempts to access this photo, achieving protection of the resource by "outsourcing" this task to CopMonkey.
</p>
<p>At the time Alice indicates she would like this photo protected, Photoz can choose to redirect Alice to CopMonkey for further policy setting, access auditing, and other AM-related tasks (user experience only).
</p>
<p>Over time, as Alice uploads other photos and creates and organizes photo albums, and as Photoz makes new action functionality available, Photoz can use additional methods of the resource registration API to ensure that CopMonkey's understanding of Alice's protected resources matches its own.
</p>
<a name="action-desc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
Scope Descriptions</h3>

<p>The host defines a scope of access that is available for use with resources it manages in a publicly Web-accessible document containing a scope description. The scopes available for use at any one host MUST have unique URI references so that the host's scope descriptions are distinguishable by URI reference; the URI reference MAY include a fragment identifier. Scope descriptions MAY reside anywhere; the host is not required to self-host scope descriptions and may wish to point to standardized scope descriptions residing elsewhere.
</p>
<p>A scope description is a <a class='info' href='#RFC4627'>JSON<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> [RFC4627] object with the name "scope" and with the following parameters:</p>
<blockquote class="text"><dl>
<dt>_id</dt>
<dd>REQUIRED. A string that uniquely identifies the scope across all scopes available at this host.
</dd>
<dt>name</dt>
<dd>REQUIRED. A human-readable string describing the scope of access. The AM SHOULD use the name in its user interface to assist the user in setting policies for protected resource sets that have this available scope.
</dd>
<dt>icon_uri</dt>
<dd>OPTIONAL. A URI for a graphic icon representing the scope. If this is provided, the AM SHOULD use the referenced icon in its user interface to assist the user in setting policies for protected resource sets that have this available scope.
</dd>
</dl></blockquote>

<p>For example, this description characterizes a scope that involves reading or viewing resources (vs. creating them or editing them in some fashion):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
        "scope":
            {
            "_id": "view"
            "name": "Read-only",
            "icon_uri": "http://www.example.com/icons/reading-glasses"
        }
}</pre></div>
<p>Scope descriptions MAY contain extension parameters that are not defined in this specification. The names of extension parameters MUST begin with "x-" or "X-".
</p>
<a name="resource-set-desc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.3"></a><h3>2.4.3.&nbsp;
Resource Set Descriptions</h3>

<p>The host defines a resource set that needs protection by registering a resource set description at the AM. The host registers the description and manages its lifecycle at the AM's host registration endpoint by using the resource registration API (see <a class='info' href='#reg-api'>Section&nbsp;2.4.4<span> (</span><span class='info'>Resource Registration API</span><span>)</span></a>). The resource set description is a <a class='info' href='#RFC4627'>JSON<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> [RFC4627] object with the name "resource_set" and with the following parameters:</p>
<blockquote class="text"><dl>
<dt>_id</dt>
<dd>REQUIRED. A string that uniquely identifies the resource set. The resource set identifier has meaning only to the host, except insofar as the AM is able to map this resource set description to a particular user by virtue of the particular host access token used to access the resource registration API. The host MAY use any identifier scheme to represent resource sets, for example, making its identifiers unique across all users of this host or allowing for the sharing of resource set identifiers among users. However, for privacy reasons, it is RECOMMENDED that the host assign an identifier that is obscured with respect to any human-readable resource set label used at this host. Further, this identifier MUST match the resource set identifier path component of the URI used to manage this description in the resource registration API; see <a class='info' href='#reg-api'>Section&nbsp;2.4.4<span> (</span><span class='info'>Resource Registration API</span><span>)</span></a> for more information. (Typically this matching is achieved through automatically populating the parameter value on initial registration of the description.)
</dd>
<dt>name</dt>
<dd>REQUIRED. A human-readable string describing a set of one or more resources. The AM SHOULD use the name in its user interface to assist the user in setting policing for protecting this resource set.
</dd>
<dt>icon_uri</dt>
<dd>OPTIONAL. A URI for a graphic icon representing the resource set. If provided, the AM SHOULD use the referenced icon in its user interface to assist the user in setting policies for protecting this resource set.
</dd>
<dt>scopes</dt>
<dd>REQUIRED. An array referencing one or more URIs of scope descriptions that are available for this resource set.
</dd>
</dl></blockquote>

<p>For example, this description characterizes a resource set (a photo album) that can potentially be only viewed, or alternatively to which full access can be granted; the URIs point to scopes descriptions as defined in <a class='info' href='#action-desc'>Section&nbsp;2.4.2<span> (</span><span class='info'>Scope Descriptions</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>{
        "resource_set":
            {
            "_id":  "112210f47de98100",
            "name": "Photo album",
            "icon_uri": "http://www.example.com/icons/flower",
            "scopes":
                        ["http://photoz.example.com/dev/scopes/view",
                        "http://photoz.example.com/dev/scopes/all"]
        }
}</pre></div>
<p>Resource set descriptions descriptions MAY contain extension parameters that are not defined in this specification. The names of extension parameters MUST begin with "x-" or "X-". (ISSUE #29: Extend resource set/scope descriptions with additional parameters being used by the SMART team?)
</p>
<p>When a host creates or updates a resource set description (see <a class='info' href='#reg-api'>Section&nbsp;2.4.4<span> (</span><span class='info'>Resource Registration API</span><span>)</span></a>), the AM MUST attempt to retrieve the referenced action descriptions. It MAY cache such descriptions as long as indicated in the HTTP header for the action description resource unless the resource set description is subsequently updated within the validity period. At the beginning of an authorizing user's login session at the AM, the AM MUST attempt to re-retrieve action descriptions applying to that user whose cached versions have expired.
</p>
<p>(ISSUE #33: Syntactic sugar for "implicit resource sets" where there's a single API endpoint?)
</p>
<a name="reg-api"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4"></a><h3>2.4.4.&nbsp;
Resource Registration API</h3>

<p>The host uses a RESTful API at the AM's host registration endpoint to create, read, update, and delete resource set descriptions, along with listing groups of such descriptions. The host MUST use its valid host access token obtained previously to gain access to this endpoint.
</p>
<p>Individual resource set descriptions are managed at URIs with this structure: "{reguri}/host/{hostid}/resource_set/{resourcesetid}"
</p>
<p>The components of these URIs are defined as follows:</p>
<blockquote class="text"><dl>
<dt>{reguri}</dt>
<dd>The AM's host registration endpoint as advertised in its metadata (see <a class='info' href='#am-endpoints'>Section&nbsp;2.1.1<span> (</span><span class='info'>AM Endpoints</span><span>)</span></a>).
</dd>
<dt>{hostid}</dt>
<dd>A registration area at the AM that is specific to this host. The host MUST use the OAuth client identifier it was assigned by this AM as its host identifier. If the host identifier does not match the host access token used at the host registration endpoint, the AM MUST report an HTTP 403 Forbidden error (see example below) and fail to act on the request. (ISSUE #30: This doesn't allow "anonymous" credentials. OK?)
</dd>
<dt>{resourcesetid}</dt>
<dd>An identifier for a resource set description. The identifier MUST match the "_id" parameter value in the description itself.
</dd>
</dl></blockquote>

<p>Without a specific resource set identifier path component, the URI applies to the set of resource set descriptions already registered.
</p>
<p>Following is a summary of the five registration API operations the AM is REQUIRED to support. Each is defined in its own section below. All other methods are unsupported.</p>
<ul class="text">
<li>Create resource set description: PUT /host/{hostid}/resource_set/{resourcesetid}
</li>
<li>Read resource set description: GET /host/{hostid}/resource_set/{resourcesetid}
</li>
<li>Update resource set description: PUT /host/{hostid}/resource_set/{resourcesetid}
</li>
<li>Delete resource set description: DELETE /host/{hostid}/resource_set/{resourcesetid}
</li>
<li>List resource set descriptions: GET /host/{hostid}/resource_set/
</li>
</ul>

<p>The AM MUST respond to host requests using unsupported HTTP methods with an HTTP 403 Forbidden error and MUST fail to act on the request.
</p>
<p>HTTP response (unsupported method or host ID not matching the presented host access token):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 403 Forbidden
...

(Body provides user-readable explanation of the error.)</pre></div>
<a name="create-resource-set"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4.1"></a><h3>2.4.4.1.&nbsp;
Create Resource Set Description</h3>

<p>Adds a new resource set description using the PUT method, thereby putting it under the AM's protection. The host assigns a unique identifier to the action. The host is free to use its own methods of identifying and describing resource sets; the AM MUST treat them as opaque for the purpose of authorizing access, other than associating them with the authorizing user represented by the host access token used to access the API. On successfully registering a resource set, the host MUST use UMA mechanisms to limit access to any resources corresponding to this resource set. (ISSUE #31: Should the response contain a replay of the description just registered? See, for example, how SCIM works.)
</p>
<p>HTTP request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PUT /host/{hostid}/resource/{resourceid}
Content-Type: application/json
...

(Body contains JSON representation of resource set description to be created.)</pre></div>
<p>HTTP response (success):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 201 Created
Content-Type: application/json
Location: (URL of the created resource, same as that which was PUT.)
...</pre></div>
<a name="read-resource-set"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4.2"></a><h3>2.4.4.2.&nbsp;
Read Resource Set Description</h3>

<p>Reads a previously registered resource set description using the GET method.
</p>
<p>HTTP request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GET /host/{hostid}/resource/{resourceid} HTTP/1.1
...</pre></div>
<p>HTTP response (success):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 200 OK
Content-Type: application/json
ETag: (entity tag of the resource artifact)
...

(Body contains JSON representation of the resource set description.)</pre></div>
<p>HTTP response (not found):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 404 Not Found
...

(Body provides user-readable explanation of the error.)</pre></div>
<a name="update-resource-set"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4.3"></a><h3>2.4.4.3.&nbsp;
Update Resource Set Description</h3>

<p>Updates a previously registered resource set description using the PUT method, thereby changing the resource set's protection characteristics.
</p>
<p>This API is different from the create new resource set description (<a class='info' href='#create-resource-set'>Section&nbsp;2.4.4.1<span> (</span><span class='info'>Create Resource Set Description</span><span>)</span></a>) because it assumes that prior registration of the resource has occured.
</p>
<p>(ISSUE#27: Can Update Resource Set Description API mistakenly overwrite/destroy an existing resource description? Also see ISSUE #31: Should the response replay the just-registered description?)
</p>
<p>HTTP request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>PUT /host/{hostid}/resource/{resourceid}
Content-Type: application/json
If-Match: (entity tag of the resource if operation is to be idempotent)
...

(Body contains JSON representation of resource set description to be updated.)</pre></div>
<p>HTTP response (success):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 204 No Content
...</pre></div>
<p>HTTP response (entity tag does not match):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 412 Precondition failed
...</pre></div>
<a name="delete-resource-set"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4.4"></a><h3>2.4.4.4.&nbsp;
Delete Resource Set Description</h3>

<p>Deletes a previously registered resource set description using the DELETE method, thereby removing it from the AM's protection regime.
</p>
<p>HTTP request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>DELETE /host/{hostid}/resource/{resourceid}
If-Match: (entity tag of the resource if operation to be idempotent)
...</pre></div>
<p>HTTP response (success):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 204 No content
...</pre></div>
<p>HTTP response (not found):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 404 Not Found
...

(Body provides user-readable explanation of the error.)</pre></div>
<p>HTTP response (entity tag does not match):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 412 Precondition failed
...</pre></div>
<a name="list-resource-sets"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4.5"></a><h3>2.4.4.5.&nbsp;
List Resource Set Descriptions</h3>

<p>Lists all previously registered resource set identifiers for this user using the GET method. The list is in the form of a JSON array of {resourcesetid} values.
</p>
<p>HTTP request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GET /host/{hostid}/resource_set/
...</pre></div>
<p>HTTP response:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 200 OK
Content-Type: application/json
...

(Body contains JSON array of {resourcesetid} values.)</pre></div>
<a name="getting-authz-accessing-resource"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Getting Authorization and Accessing a Resource</h3>

<p>Phase 2 of UMA is getting authorization, and Phase 3 is accessing a resource. In these phases, an AM orchestrates and controls requesting parties' access to a user's protected resources at a host, under conditions dictated by that user.
</p>
<p>A series of pairwise interactions characterize this entire authorization and access process. Phase 2 always begins with the requester attempting access at a protected resource endpoint at the host. How the requester came to learn about this endpoint is out of scope for UMA; the authorizing user might, for example, have advertised its availability publicly on a blog or other website, listed it in a discovery service, or emailed a link to a particular intended requesting party.
</p>
<p>The host responds to the requester's access request in one of several ways depending on the circumstances of the request, either immediately or having first performed one or more embedded interactions with the AM. Depending on the nature of the host's response to an failed access attempt, the requester itself engages in embedded interactions with the AM before re-attempting access.
</p>
<p>Phase 3 is merely the successful completion of a requester's access attempt (see <a class='info' href='#sufficient-scope'>Section&nbsp;3.1.5<span> (</span><span class='info'>Requester's Token Has Sufficient Permission</span><span>)</span></a>) that initially involved several embedded interactions among the requester, AM, and host in Phase 2.
</p>
<p>The interactions can be summarized as follows. The interaction summarized in each top-level list item MAY stop at the end of that time, if the requester chooses not to continue pursuing access to the resource.</p>
<ul class="text">
<li>The requester attempts access at a particular protected resource at a host (see <a class='info' href='#r-h-attempt-access'>Section&nbsp;3.1<span> (</span><span class='info'>Requester-Host: Attempt Access at Protected Resource</span><span>)</span></a>).
<ul class="text">
<li>If the user corresponding to the protected resource URI is ambiguous: host responds immediately with an error (see <a class='info' href='#ambiguous-user'>Section&nbsp;3.1.1<span> (</span><span class='info'>Requester's Request Is Ambiguous</span><span>)</span></a>).
</li>
<li>If the user is unambiguous but the access attempt is unaccompanied by a requester access token: host responds immediately with instructions on where to go to obtain one (see <a class='info' href='#no-token'>Section&nbsp;3.1.2<span> (</span><span class='info'>Requester Presents No Access Token</span><span>)</span></a>).
</li>
</ul>
</li>
<li>If the access attempt was accompanied by a requester access token, the host validates the token at the AM (see <a class='info' href='#h-am-token-validation'>Section&nbsp;3.3<span> (</span><span class='info'>Host-AM: Validate Requester's Presented Access Token</span><span>)</span></a>).
<ul class="text">
<li>If the AM reports that the requester access token is invalid (see <a class='info' href='#token-invalid'>Section&nbsp;3.3.1<span> (</span><span class='info'>AM Returns a Token Invalid Response</span><span>)</span></a>), the host responds with instructions on where to go to obtain a token (see <a class='info' href='#no-token'>Section&nbsp;3.1.2<span> (</span><span class='info'>Requester Presents No Access Token</span><span>)</span></a>).
</li>
</ul>
</li>
<li>If the AM reports that the requester access token is valid (see <a class='info' href='#token-valid'>Section&nbsp;3.3.2<span> (</span><span class='info'>AM Returns a Token Valid Response</span><span>)</span></a>) but none of the permissions associated with the token match the scope of attempted access, the host registers a suitable permission on the requester's behalf at the AM (see <a class='info' href='#h-am-register-scope'>Section&nbsp;3.4<span> (</span><span class='info'>Host-AM: Register a Permission</span><span>)</span></a>) and then responds to the requester with instructions on where to go to request authorization to associate that permission with its token (see <a class='info' href='#insufficient-scope'>Section&nbsp;3.1.4<span> (</span><span class='info'>Requester's Token Has Insufficient Permission</span><span>)</span></a>).
</li>
<li>If the requester received instructions on where to go to get a token, it requests a token from the appropriate AM (see <a class='info' href='#r-am-obtain-token'>Section&nbsp;3.2<span> (</span><span class='info'>Requester-AM: Requester Obtains Access Token</span><span>)</span></a>).
</li>
<li>If the requester received instructions on where to go to get authorization for access permission, it requests permission from the appropriate AM (see <a class='info' href='#r-am-authz-scope'>Section&nbsp;3.5<span> (</span><span class='info'>Requester-AM: Request Authorization for Scoped Permission</span><span>)</span></a>).
</li>
<li>If the AM reported that the requester access token is valid, and at least one of the permissions associated with the token match the scope of attempted access, the host responds to the requester's access attempt with success (see <a class='info' href='#sufficient-scope'>Section&nbsp;3.1.5<span> (</span><span class='info'>Requester's Token Has Sufficient Permission</span><span>)</span></a>).
</li>
</ul>

<p>This process extends OAuth in several notable ways:</p>
<ul class="text">
<li>The requester access token signifies only a binding of this requester, the requesting party on whose behalf it is acting, this host, this authorizing user, and this AM, to be reused for all permissions to access any of the user's protected resources at this host that are protected by this AM.
</li>
<li>Any real-time authorizing user (resource owner) consent required by policy is gathered at the time of claim requests, rather than at the time of token issuance; the flow does not distinguish between policies for "person-to-person" sharing and policies for "person-to-self" sharing.
</li>
<li>The process of seeking authorization does not just rely on the requester's ability to authenticate as the (or a) resource owner, but admits a wide-ranging set of policy options based on attributes of the requesting party. This model could be called claims-based authorization.
</li>
</ul>

<p>The interactions are described in detail in the following sections.
</p>
<a name="r-h-attempt-access"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Requester-Host: Attempt Access at Protected Resource</h3>

<p>This interaction assumes that the host has previously registered with an AM one or more resource sets that correspond to the resource to which access is being attempted, such that the host considers this resource to be protected by a particular AM.
</p>
<p>The requester is typically attempts to access the desired resource at the host directly (for example, when a human operator of the requester software clicks on a thumbnail representation of the resource). The requester is expected to discover, or be provisioned with, knowledge of the protected resource and its location out of band. Further, the requester is expected to acquire its own knowledge about the methods made available by the host for operating on this resource (such as viewing it with a GET method, or transforming it with some complex API call) and the possible scopes of access.
</p>
<p>The host responds in one of five ways.
</p>
<a name="ambiguous-user"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Requester's Request Is Ambiguous</h3>

<p>By the nature of the requester's request for access (for example, through a URI parameter specifying a username or other identifier), the host needs to be able to detect uniquely which one of its users has the operative control over access to this resource. Without this, the host will be unable to interact with the correct AM using the correct host access token in protecting the resource.
</p>
<p>If the requester's request is ambiguous with respect to the specific user at the host, the host rimmediately esponds with an "ambiguous-user error" message.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<a name="no-token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Requester Presents No Access Token</h3>

<p>If the host is able to detect uniquely which one of its users has the operative control over access to the resource (see <a class='info' href='#ambiguous-user'>Section&nbsp;3.1.1<span> (</span><span class='info'>Requester's Request Is Ambiguous</span><span>)</span></a>), but the requester does not present any access token with the request, the host MUST return an HTTP 400 status code indicating it is an "invalid_request" [REF: Section 2.4.1 of OAuth Bearer Token draft]. This indicates to the requester one of the following: that the request is missing a required parameter, that it includes an unsupported parameter or parameter value, that it repeats the same parameter, that it uses more than one method for including an access token, or that it is otherwise malformed.
</p>
<p>(ISSUE #32: Need more detail here. It needs to convey the AM hostmeta endpoint so that the requester can discover the right token endpoint to use.)
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Requester Presents an Invalid Access Token</h3>

<p>If the requester presents an access token with its request, the host engages in a token validation interaction with the AM to test its validity (see <a class='info' href='#h-am-token-validation'>Section&nbsp;3.3<span> (</span><span class='info'>Host-AM: Validate Requester's Presented Access Token</span><span>)</span></a>). If the AM reports that the token is invalid, the Host SHOULD return an HTTP 401 status code indicating it is an "invalid_token" [REF: Section 2.4.1 of Oauth Bearer Token draft]. This indicates to the requester that the access token provided is expired, revoked, malformed, or invalid for other reasons.
</p>
<p>(ISSUE #32: Need more detail here, as above. It needs to convey the AM hostmeta endpoint so that the requester can discover the right token endpoint to use.)
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<a name="insufficient-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.4"></a><h3>3.1.4.&nbsp;
Requester's Token Has Insufficient Permission</h3>

<p>If the requester presents an access token with its request, the host engages in a token validation interaction with the AM to test its validity (see <a class='info' href='#h-am-token-validation'>Section&nbsp;3.3<span> (</span><span class='info'>Host-AM: Validate Requester's Presented Access Token</span><span>)</span></a>). If the AM reports that the requester's access token is valid, the host examines the returned token status. If the token status does not, in the host's judgment, contain any permission that applies to the scope of access attempted by the requester, the Host SHOULD register the desired permission with the AM (see <a class='info' href='#h-am-register-scope'>Section&nbsp;3.4<span> (</span><span class='info'>Host-AM: Register a Permission</span><span>)</span></a>) and then respond to the requester with the HTTP 403 (Forbidden) status code indicating that the token has "insufficient_scope" [REF: Section 2.4.1 of Oauth Bearer Token draft], along with providing the permission ticket it just received from the AM.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<a name="sufficient-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.5"></a><h3>3.1.5.&nbsp;
Requester's Token Has Sufficient Permission</h3>

<p>If the requester presents an access token with its request, the host engages in a token validation interaction with the AM to test its validity (see <a class='info' href='#h-am-token-validation'>Section&nbsp;3.3<span> (</span><span class='info'>Host-AM: Validate Requester's Presented Access Token</span><span>)</span></a>). If the AM reports that the requester's access token is valid, the host examines the returned token status. If the token status, in the host's judgment, contains at least one permission that applies to the scope of access attempted by the requester, the host gives access to the desired resource.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<p>This response constitutes the conclusion of Phase 3 of UMA.
</p>
<a name="r-am-obtain-token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Requester-AM: Requester Obtains Access Token</h3>

<p>When a requester does not possess a valid access token to access resources of a particular user at a particular host, it requests one from the AM. Each such token is unique per requester; requesting party on whose behalf the requester software is operating; authorizing user; AM; and host. It is not unique per protected resource or resource set; the token represents the set of permissions for that requesting party to access potentially a large set of different resource sets with a variety of scopes.
</p>
<p>When possible, the requester SHOULD use the the OAuth2.0 client credentials authorization grant type (see Section 4.4 of <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a>).
</p>
<p>In UMA, unlike in plain OAuth, obtaining an access token does not automatically convey permission for access to any protected resource. The token must first be associated with at least one suitable permission for scoped access in order for the requester to succeed in accessing the resource.
</p>
<p>In the case where the requester does not yet have a unique credential and where the AM demands such a unique credential, the requester MAY use the dynamic registration protocol (see <a class='info' href='#Dyn-Reg'>[Dyn&#8209;Reg]<span> (</span><span class='info'>Scholz, C., &ldquo;OAuth Dynamic Client Registration Protocol,&rdquo; 2010.</span><span>)</span></a>), if the AM supports or requires it. The dynamic registration protocol allows the AM to provide the requester with a unique client identifier and optionally a client secret in a dynamic fashion.
</p>
<a name="h-am-token-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Host-AM: Validate Requester's Presented Access Token</h3>

<p>On receiving a requester access token in an access attempt, the host asks the AM to validate this token. It gains authorized access to the AM's token validation endpoint by presenting its own host access token in the request to validate the requester's access token. The host access token also allows the host and AM to uniquely identify the user they have in common, and therefore allows the AM to look up the correct user policies and settings.
</p>
<p>The host's request to the AM is made with a POST containing the requester access token and the IP address of the requester's request. The host MAY, at its discretion, instead supply the originating IP address indicated in the requester's X-Forwarded-For: header value. The POST uses the "application/x-www-form-urlencoded" format as defined by [W3C.REC-html401-19991224]. The IP address or originating IP address is advisory only; the AM MAY ignore it for token validation purposes. The host supplies its host access token with the request.
</p>
<p>(ISSUE #35: Consider allowing the host to provide a filter in the token validation request to indicate the particular resource sets/scopes it would find acceptable, so that the AM can provide only permissions that potentially match any of them. This approaches a PDP/PEP model.)
</p>
<p>Example of a request to the token validation endpoint that provides the host access token in the header:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST /token_validation HTTP/1.1
Host: am.example.com
Authorization: OAuth vF9dft4qmT
Content-Type: application/x-www-form-urlencoded

token=sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv&amp;ipaddr=192.168.1.1
</pre></div>
<a name="token-invalid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
AM Returns a Token Invalid Response</h3>

<p>If the the AM finds the requester's access token to be invalid, it returns an UMA error message (ISSUE#12: correct? HTTP success?) to indicate that the requester's token is invalid.
</p>
<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<a name="token-valid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.2"></a><h3>3.3.2.&nbsp;
AM Returns a Token Valid Response</h3>

<p>If the the AM finds the requester's access token to be valid, it returns an UMA success message (with HTTP success) which supplies the token status in an HTTP response using the 200 OK status code, containing a JSON <a class='info' href='#RFC4627'>[RFC4627]<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> document supplying the token status description. The token status supplies all of the permissions that are currently valid for this requester access token (and thus for the requesting party on whose behalf it is acting).
</p>
<p>The token status description is a JSON object with the name "token_status" containing an array of permission objects, each with the following parameters:</p>
<blockquote class="text"><dl>
<dt>_id</dt>
<dd>REQUIRED. A string that uniquely identifies the resource set, access to which has been granted to this requester on behalf of this requesting party. The identifier MUST correspond to a resource set that was previously registered as protected.
</dd>
<dt>scopes</dt>
<dd>REQUIRED. An array referencing one or more URIs of scopes to which access was granted for this resource set. Each scope MUST correspond to a scope that was registered by this host for the referenced resource set.
</dd>
<dt>exp</dt>
<dd>REQUIRED.An integer representing the expiration time on or after which the permission MUST NOT be accepted for authorized access. The processing of the exp parameter requires that the current date/time MUST be before the expiration date/time listed in the exp claim. Host implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.
</dd>
</dl></blockquote>

<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

{
        "token_status":
           [
              {
                      "_id": "112210f47de98100",
                      "scopes":
                      ["http://photoz.example.com/dev/actions/view",
                        "http://photoz.example.com/dev/actions/all"],
                      "exp": 1300819380
              }
           ]
}</pre></div>
<p>(ISSUE #33: Syntactic sugar for "implicit resource sets" where there's a single API endpoint?)
</p>
<a name="h-am-register-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Host-AM: Register a Permission</h3>

<p>If, in the host's judgment, the permissions returned by the AM from a token validation request are insufficient to allow this requester's access attempt, the host registers a permission with the AM that it believes would be sufficient for the type of access sought. The AM returns a permission ticket for the host to give to the requester in its response (see <a class='info' href='#insufficient-scope'>Section&nbsp;3.1.4<span> (</span><span class='info'>Requester's Token Has Insufficient Permission</span><span>)</span></a>).
</p>
<p>The host registers the permission using the POST method at the AM's registration endpoint, providing its host access token to get authorized access to this endpoint. The body of the HTTP request message contains a JSON <a class='info' href='#RFC4627'>[RFC4627]<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> document providing the requester's access token and the requested permission. (ISSUE#13: How to structure the body to include the permission and also the requester access token?)
</p>
<p>The requested scope is an object with the name "requested_permission" and the following parameters:</p>
<blockquote class="text"><dl>
<dt>_id</dt>
<dd>REQUIRED. A string that uniquely identifies a resource set, access to which this requester is seeking access. The identifier MUST correspond to a resource set that was previously registered as protected.
</dd>
<dt>scopes</dt>
<dd>REQUIRED. An array referencing one or more identifiers of scopes to which access is needed for this resource set. Each scope identifier MUST correspond to a scope that was registered by this host for the referenced resource set.
</dd>
</dl></blockquote>

<p>For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>TBS</pre></div>
<p>On receiving the scope registration request from the Host, the AM issues a response message that has one of the possible following outputs: (ISSUE#06: Design needs to be completed)</p>
<ul class="text">
<li>A scope request ticket, which typically has a short life-time, and its expiration time.
</li>
<li>Error message indicating a malformed scope registration request.
</li>
</ul>

<a name="r-am-authz-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Requester-AM: Request Authorization for Scoped Permission</h3>

<p>In this interaction, the requester asks the AM to grant authorization to add a permission to its access token for use at a particular host. It does this at the AM's authorization endpoint by supplying the permission ticket it got from the host, along with its requester access token. The AM uses this information to look up the previously registered permission, confirm that the correct requester is asking for it, map the requested permission to operative user policies, and demand in turn that the requester convey any claims needed to support its request.
</p>
<p>The requester performs a GET on the authorization endpoint, using the standard HTTP "Accept" header to express the acceptable media type(s) of any claims-requested response. (ISSUE#14: Need to unify the request for authorization with the providing of claims, so that this can be a single request-response pattern that can loop as required. Should it always be a POST therefore?)
</p>
<p>The AM responds in one of three ways: </p>
<ul class="text">
<li>If the AM requires no claims (or no further claims) from the requester in order to grant authorization for the asked-for permission based on user policy, it gives a success response, indicating that the requested scope has been associated with the requester's token.
</li>
<li>If the requester is definitively not authorized for this permission according to user policy, the AM responds with a failure response and the authorization request phase ends.
</li>
<li>If user policy demands more information from the requester, the AM responds with a claims-requested response. The list SHOULD use the claim format media type that was indicated by the requester as acceptable.
</li>
</ul>

<p>The claims-requested list MAY contain internal logic that gives a choice or other variability around the sets of claims that will satisfy the request. This potentially allows the requester to select a subset of claims to supply in order to obtain the needed permission.
</p>
<p>The requester re-POSTs the authorization request, providing any claims it has chosen to supply to satisfy the request for claims. f the AM accepts the claims document submitted by the requester, the AM responds with a successful or unsuccessful access token response, or with another claims-required response. This loop can be run through as many times as necessary for the AM to request further claims and the requester to supply them, re-asking for authorization to get the needed permission at every juncture.
</p>
<p>If the content-type is not recognized by the AM, the AM will reject the document. (ISSUE#15: If the content-type (of the claims response document) is not recognized by the AM, what happens then? Should be an error from the AM.)
</p>
<p>(ISSUE#16: Eventually need some special claim types that allow for the trusted-claims model to unfold.)
</p>
<p>This specification does not define the formats of required-claims lists and claims documents. It may ultimately put minimum conformance requirements on requesters and AMs to handle particular claim formats defined in other specifications, as well as specifying requirements that claim formats seeking consideration for use in UMA must meet. One candidate specification for lightweight claims requests and responses is <a class='info' href='#Claims2.0'>Claims2.0<span> (</span><span class='info'>Maler, E., &ldquo;Claims 2.0,&rdquo; 2010.</span><span>)</span></a> [Claims2.0].
</p>
<a name="trusted-claims"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1"></a><h3>3.5.1.&nbsp;
Trusted Claims</h3>

<p>(ISSUE#16: Eventually need some special claim types that allow for the trusted-claims model to unfold.)
</p>
<p>This specification will refer to OpenID Connect emerging protocol as mechanism to support claims-based access control to enable specific UMA use cases in which the access control decision to grant access to Authorizing User's resource is made based on Requesting Party information, such as Subject's name, age, email address, role, location, etc.
</p>
<p>OpenID Connect provides authentication, authorization, and attribute transmission capability. The integration approach uses OpenID Connect protocol to request Requesting Party&#8217;s claims, leveraging OpenID Connect mechanisms to transmit attributes from distributed sources.
</p>
<p>The interoperability scenario is based on two AM's interfaces:
</p>
<p>- OpenID 2.0 Relying Party
</p>
<p>- Claims Client for OpenID Connect OpenID 2.0
</p>
<p>Relying Party interface is responsible to authenticate the Requesting Party and initialize the OpenID Connect protocol. Claims Client interface is responsible to request claims based on OpenID Connect protocol, in order to satisfy claim-based policy. The Client interacts with the OpenID Connect's Authorization Server to obtain specific access token to access to the Requesting Party&#8217;s UserInfo EndPoint (trusted claims provider).
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Error Messages</h3>

<p>[TBS: Lukasz to rewrite this section and put in appropriate "hooks" everywhere a specific error message should be produced. Possibly consider moving this section near the front of the document.]
</p>
<p>Ultimately the host is responsible for either granting the access the requester attempted, or returning an error response to the requester with a reason for the failure. <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a> defines several error responses for a resource server to return. UMA makes use of these error responses, but requires the host to "outsource" the determination of some error conditions to the AM.
</p>
<p>The host is responsible for determining "insufficient_scope". If the requester's attempted access does not match any of the scopes returned by the AM in its valid-token response to the host, the host returns an "insufficient_scope" error to the requester.
</p>
<p>The host is responsible for determining "invalid_request". If the requester's request was badly formed, the host returns an "invalid_request" error to the requester.
</p>
<p>If the AM determined that the requester access token is invalid, it returns an "invalid_requester_token" error response to the host. [@@TBS: Need to flesh out more and provide an example.] The host then returns an "invalid_token" response to the requester as described in section 5.2.1 of <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a>.
</p>
<p>If the AM determined that the requester access token has expired, it returns an "expired_requester_token" error response to the host. [@@TBS: Need to flesh out more and provide an example.] The host then returns an "invalid_token" response to the requester as described in section 5.2.1 of <a class='info' href='#OAuth2'>[OAuth2]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;The OAuth 2.0 Protocol,&rdquo; 2010.</span><span>)</span></a>.
</p>
<p>If the host's token validation request message itself was badly formed, the AM returns an "invalid_request" error to the host. [@@Need to say what happens to the requester after that?]
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>This specification relies mainly on OAuth security mechanisms for protecting the host registration endpoint at the AM so that only a properly authorized host can access it on behalf of the intended user. For example, the host needs to use a valid host access token issued through a user authorization process at the endpoint, and the interaction should take place over TLS. It is expected that the host will protect its client secret (if it was issued one) and will protect its host access token, particularly if used in "bearer token" fashion.
</p>
<p>In addition, this specification dictates a binding between the host access token and the host-specific registration area on the AM to prevent a host from interacting with a registration area not its own.
</p>
<p>(ISSUE#18: All drafts are required to have a security considerations section. See RFC 3552. Other stuff goes here too. Provide commentary on any requirements layered on the forthcoming OAuth security considerations section; discuss UMA-layer implications for more meaningful authentication of requesters/requesting parties; discuss implications of user-mediated AM/host trust model; discuss short-lived token technique for lightweight requester correlation...)
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Privacy Considerations</h3>

<p>The AM comes to be in possession of resource set information (such as names and icons) that may reveal information about the user, which the AM's trust relationship with the host is assumed to accommodate. However, the requester is a less-trusted party (in fact, entirely untrustworthy until it acquires a requester access token in UMA protocol step 2). This specification recommends obscuring resource set identifiers in order to avoid leaking personally identifiable information to requesters through the "scope" mechanism.
</p>
<p>(ISSUE#19: Other stuff goes here too. More privacy considerations.)
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Conformance</h3>

<p>This section outlines conformance requirements for various entities implementing UMA endpoints. Currently two levels of conformance are defined: minimal and full. (Other types or levels may ultimately be defined in this specification or in other specifications that profile or extend this one.)
</p>
<p>This specification has dependencies on other specifications, as follows:</p>
<ul class="text">
<li>OAuth 2.0: AMs, hosts, and requesters MUST support OAuth 2.0 features named in this specification for minimal conformance. For example, features related to refresh tokens, client secrets, and the web server profile are mentioned and support for them is REQUIRED.
</li>
<li>Dynamic registration: For full conformance, AMs MUST support dynamic registration. For minimal conformance, AMs are not required to support dynamic registration. Hosts need not support the requesting of dynamic registration at either conformance level.
</li>
</ul>

<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>TBD
</p>
<a name="Acknowledgments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p>The contributors to this specification include the Kantara UMA Work Group participants, a list of whom can be found at <a class='info' href='#UMAnitarians'>[UMAnitarians]<span> (</span><span class='info'>Maler, E., &ldquo;UMA Participant Roster,&rdquo; 2011.</span><span>)</span></a>.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Issues</h3>

<p>Catalog of issues (some noted within the text above as well, indicated by "ISSUE"):</p>
<ol class="text">
<li>ISSUE#01: REPLACED BY ISSUE #17. (Need to specify options for claim formats in the XRD.)
</li>
<li>ISSUE#02: RESOLVED. (Need to clarify how the requester's user authorization endpoint would be used in an UMA (vs. an OAuth) fashion for collecting synchronous authorizing user consent in Phase 2, based on a privileged type of claim request.) RESOLUTION: The need for this endpoint goes away because it's all handled by policies that require certain claims to be provided, one of which could be for the requesting party to prove it has a certain identity (which could happen to be an identity that the authorizing user can prove). EDITED IN: Rev 11.
</li>
<li>ISSUE#03: RESOLVED. (Do we need to specify explicitly a means for the requester to get a new or refreshed access token from the AM, or can we mostly just refer to OAuth for this? Right now this interaction type doesn't have its own section.) RESOLUTION: New section added. EDITED IN: Rev 09 (I think).
</li>
<li>ISSUE#04: REPLACED BY ISSUE #32. (Need to specify the format of the token validation request message. Can Maciej supply what they're using?)
</li>
<li>ISSUE#05: When the token is invalid, what's the current OAuth thinking on what we should return? Is there any reason not to copy OAuth as closely as possible in this case? Or should a token status of "invalid" be used, and returned as success (unifying the different kinds of responses to the validation request)?
</li>
<li>ISSUE#06: Need to complete the design of the permission registration interaction and its associated error messages.
</li>
<li>ISSUE#07: Need to complete the design of the authorization request interaction and its associated error messages.
</li>
<li>ISSUE#08: RESOLVED. (Sort out whether resource set descriptions are supposed to use scope URIs or scope identifiers.) EDITED IN: Rev 11.
</li>
<li>ISSUE#09: RESOLVED. (Move the resource registration API section to be a subsection under the previous big section.) EDITED IN: Rev 11.
</li>
<li>ISSUE#10: RESOLVED. (Copy over the resource set description and scope description content.) RESOLUTION: Copied over. EDITED IN: Rev 07 (I think).
</li>
<li>ISSUE#11:RESOLVED. (Refer to OAuth processes for getting a token "autonomously" here? Currently there is no section for the requester-AM token-getting interaction.) RESOLUTION: A new section has been added, to discuss about the usage of OAuth flow for the requester to gen a token from the AM. EDITED IN: Rev 09 (I think).
</li>
<li>ISSUE#12: If the the AM finds the requester's access token to be invalid, it returns an UMA error message (correct? HTTP success?) to indicate that the requester's token is invalid.
</li>
<li>ISSUE#13: How to structure the body to include the scope and also the requester's access token?
</li>
<li>ISSUE#14: Need to unify the request for authorization with the providing of claims, so that this can be a single request-response pattern that can loop as required.
</li>
<li>ISSUE#15: If the content-type (of the claims response document) is not recognized by the AM, what happens then? Should be an error from the AM.
</li>
<li>ISSUE#16: Eventually need some special claim types that allow for the trusted-claims model to unfold.
</li>
<li>ISSUE#17: Need to say what claims format is supported. "openid-connect" is now listed as the only option, temporarily.
</li>
<li>ISSUE#18: Provide commentary on any requirements layered on the forthcoming OAuth security considerations section; discuss UMA-layer implications for more meaningful authentication of requesters/requesting parties; discuss implications of user-mediated AM/host trust model; discuss short-lived token technique for lightweight requester correlation...
</li>
<li>ISSUE#19: Other stuff goes here too. More privacy considerations.
</li>
<li>ISSUE#20: From Lukasz email 6/6/2011: Rev8 Section 2.2: +1 for validation request in json format instead of application/x-www-form-urlencoded.
</li>
<li>ISSUE#21: From Lukasz email 6/6/2011: Rev8 Section 2.4: AM adds a scope to the requester's access token. Maybe I am missing something but I don't see the explanation in the spec how requester's token is issued at first. I think some parts are mutual for the host and the requester i.e. AM Discovery, optional Dynamic Client Registration.
</li>
<li>ISSUE#22: From Lukasz email 6/6/2011: Rev8 Section 3.4.2: Example is missing required '_id' parameter. ACTION#22: '_id' parameter added.
</li>
<li>ISSUE#23: From Lukasz email 6/6/2011: Rev8 Section 4: 403 Forbidden response when: 'unsupported method or host ID not matching the presented host access token'. I think AM should return 403 in case of performing operations on resources of different user (not owned resources at this same host), instead of returning 404 Not Found to not disclose presence of the resource set at the AM.
</li>
<li>ISSUE#24: From Lukasz email 6/6/2011: Rev8 Section 4.1: Empty response body? In SAM we return 'resource_id' and 'policy_uri' so that the host can redirect the user to the policy definition page (sharing setting screen) on AM.
</li>
<li>ISSUE#25: From Lukasz email 6/6/2011: Section 4.1 - what happens when a resource (being registered) already exists?
</li>
<li>ISSUE#26: RESOLVED. From Lukasz email 6/6/2011: Section 4.1 to 4.4: URLs in the examples mistakenly contains '/user/{userid}'. RESOLUTION: Examples have been corrected.
</li>
<li>ISSUE#27: Can Update Resource Set Description API mistakenly overwrite/destroy an existing resource description?. (<a class='info' href='#update-resource-set'>Section&nbsp;2.4.4.3<span> (</span><span class='info'>Update Resource Set Description</span><span>)</span></a>)
</li>
<li>ISSUE #28: Okay to require the AM to support the authorization code grant type, in addition to optionally supporting the SAML bearer assertion grant type, to give a baseline of mandatory-to-implement functionality? Lukasz and Eve agree so far.
</li>
<li>ISSUE #29: Should we extend the resource set (and/or scope) description parameters along the lines of the SMART project? Related to ISSUE #24 as well.
</li>
<li>ISSUE #30: We say the {hostid} has to be the client ID, but what if the host is in the position of using anonymous credentials for some reason? Is that even a possibility in the case of hosts (vs. requesters)? Should we identify this more obviously as a constraint? Lukasz and Eve think it should be identified as a constraint, meaning that if dynamic registration is used, it has to support truly unique client credential issuance.
</li>
<li>ISSUE #31: Should the response to creating or updating a resource set description play back the just-registered description? See how SCIM works for an example of this.
</li>
<li>ISSUE #32: Need to add back detail on how the host tells the requester which AM to go to so that it can discover the token endpoint and authorization endpoint. Lukasz and Maciej will flesh this out with their own message examples.
</li>
<li>ISSUE #33: Should it be possible to have an "implicit resource set" somehow that (in syntactic-sugar fashion) allows permissions to be passed around much as scopes already are passed around in plain OAuth?
</li>
<li>ISSUE #34: Should we have only one host registration endoint, or do we need two: one for resource set registration and one for permission registration?
</li>
<li>ISSUE #35: Consider allowing the host to provide a filter in the token validation request to indicate the particular resource sets/scopes it would find acceptable, so that the AM can provide only permissions that potentially match any of them. This approaches a PDP/PEP model.
</li>
</ol>

<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="Claims2.0">[Claims2.0]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://wguma.org/confluence/display/uma/Claims+2.0">Claims 2.0</a>,&rdquo; 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="Dyn-Reg">[Dyn-Reg]</a></td>
<td class="author-text">Scholz, C., &ldquo;<a href="http://tools.ietf.org/html/draft-hardjono-oauth-dynreg-00.html">OAuth Dynamic Client Registration Protocol</a>,&rdquo; 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.hammer-hostmeta">[I-D.hammer-hostmeta]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://tools.ietf.org/html/draft-hammer-hostmeta-13">Web Host Metadata</a>,&rdquo; draft-hammer-hostmeta-13 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-hammer-hostmeta-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-httpbis-p1-messaging">[I-D.ietf-httpbis-p1-messaging]</a></td>
<td class="author-text">Fielding, R., Gettys, J., Mogul, J., Nielsen, H., Masinter, L., Leach, P., Berners-Lee, T., and J. Reschke, &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-09">HTTP/1.1, part 1: URIs, Connections, and Message Parsing</a>,&rdquo; draft-ietf-httpbis-p1-messaging-09 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-httpbis-p1-messaging-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ID-ietf-httpbis-p1-messaging">[ID-ietf-httpbis-p1-messaging]</a></td>
<td class="author-text">Fielding, R., &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14">http://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14</a>,&rdquo; 2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth-SAML">[OAuth-SAML]</a></td>
<td class="author-text">Campbell, B., &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-saml2-bearer-03">SAML 2.0 Bearer Assertion Grant Type Profile for OAuth 2.0</a>,&rdquo; February&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth2">[OAuth2]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-16">The OAuth 2.0 Protocol</a>,&rdquo; 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2617">[RFC2617]</a></td>
<td class="author-text"><a href="mailto:john@math.nwu.edu">Franks, J.</a>, <a href="mailto:pbaker@verisign.com">Hallam-Baker, P.</a>, <a href="mailto:jeff@AbiSource.com">Hostetler, J.</a>, <a href="mailto:lawrence@agranat.com">Lawrence, S.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, Luotonen, A., and <a href="mailto:stewart@OpenMarket.com">L. Stewart</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>,&rdquo; RFC&nbsp;2617, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2617.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2617.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2617.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4627">[RFC4627]</a></td>
<td class="author-text">Crockford, D., &ldquo;<a href="http://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>,&rdquo; RFC&nbsp;4627, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4627.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5785">[RFC5785]</a></td>
<td class="author-text">Nottingham, M. and E. Hammer-Lahav, &ldquo;<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>,&rdquo; RFC&nbsp;5785, April&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5785.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="hostmeta">[hostmeta]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://xml.resource.org/public/rfc/bibxml3/reference.I-D.draft-hammer-hostmeta-13.xml">Web Host Metadata</a>,&rdquo; 2010.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="UMA-usecases">[UMA-usecases]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">UMA Scenarios and Use Cases</a>,&rdquo; 2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="UMA-userstories">[UMA-userstories]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/User+Stories">UMA User Stories</a>,&rdquo; 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="UMAnitarians">[UMAnitarians]</a></td>
<td class="author-text">Maler, E., &ldquo;<a href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">UMA Participant Roster</a>,&rdquo; 2011.</td></tr>
</table>

<a name="History"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Document History</h3>

<p>NOTE: To be removed by RFC editor before publication as an RFC
</p>
<p>Changes in Rev 12: See notes from 27 Jun 2011 ad hoc call: <a href='http://groups.google.com/group/kantara-initiative-uma-wg/browse_frm/thread/774ec41d3475c2fd'>http://groups.google.com/group/kantara-initiative-uma-wg/browse_frm/thread/774ec41d3475c2fd</a>.
</p>
<p>Changes in Rev 11:</p>
<ul class="text">
<li>Removed the requester user authorization endpoint, as it is now superfluous.
</li>
<li>Changed the scope-related language to include "permissions".
</li>
<li>Aligned all of the endpoint and API names.
</li>
<li>Shortened the official XRD rel values for host_registration_uri to host_reg_uri and host_token_validation_uri to host_token_val_uri. (Okay?)
</li>
</ul>

<p>Changes in Rev 9:</p>
<ul class="text">
<li>Added new top-level section on Requester obtaining an acces token from the AM.
</li>
</ul>

<p>Changes in Rev 8:</p>
<ul class="text">
<li>Added sections on Action Descriptions and Resource Set Descriptions. Text obtained from the Resource Registration doc, which is being discontinued.
</li>
</ul>

<p>Changes in Rev 7:</p>
<ul class="text">
<li>Reintroduced three-phase language, but removed overt mention of it in the sections after the introduction.
</li>
<li>Added new requester authorization endpoint for use in Phase 2.
</li>
<li>Moved the Phase 1 content after the Phases 2/3 content because requesters don't need to read it.
</li>
<li>Moved the important resource registration spec content to the core spec.
</li>
<li>Changed the old "action" language to "scope" language throughout.
</li>
</ul>

<p>Changes in Rev 6: </p>
<ul class="text">
<li>Now only using two phases.
</li>
<li>Merged Phase III into Phase II, and removed duplication of steps.
</li>
<li>Revised the Introduction section.
</li>
<li>Introduced examples section (TBD).
</li>
</ul>

<p>Changes in Rev 5: </p>
<ul class="text">
<li>Placed Etherpad items into Section 3.
</li>
<li>Used Phases (instead of stepa and substeps).
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Hardjono (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">MIT</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hardjono@mit.edu">hardjono@mit.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Christian Scholz</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">COM.lounge GmbH</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cs@comlounge.net">cs@comlounge.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://comlounge.net">http://comlounge.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Bryan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">pbryan.net</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:email@pbryan.net">email@pbryan.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://pbryan.net">http://pbryan.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Maciej Machulak</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Newcastle University</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:m.p.machulak@ncl.ac.uk">m.p.machulak@ncl.ac.uk</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://ncl.ac.uk/">http://ncl.ac.uk/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eve Maler</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">XMLgrrl.com</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:eve@xmlgrrl.com">eve@xmlgrrl.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.xmlgrrl.com/">http://www.xmlgrrl.com/</a></td></tr>
</table>
</body></html>
