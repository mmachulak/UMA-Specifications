<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Generic Framework for UMA Claim Profiles</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Generic Framework for Claim Profiling"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Client provides custom user attributes"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Client Acts as SAML Assertion Conveyor"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Client Acts as OpenID Connect Claims Conveyor"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Hybrid Approach: Client Acts as Custom Claims Conveyor and OpenID Connect Claims Conveyor"/>
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Client Redirects Requesting Party to AS"/>
<link href="#rfc.section.2.5.1" rel="Chapter" title="2.5.1 Requesting Party Claims Endpoint"/>
<link href="#rfc.section.2.5.2" rel="Chapter" title="2.5.2 Message Flow"/>
<link href="#rfc.section.2.5.3" rel="Chapter" title="2.5.3 Examples"/>
<link href="#rfc.section.2.5.3.1" rel="Chapter" title="2.5.3.1 Authorization Server Acts as OpenID Connect Relying Party"/>
<link href="#rfc.section.2.5.3.2" rel="Chapter" title="2.5.3.2 Authorization Server Acts as SAML Relying Party"/>
<link href="#rfc.section.2.5.3.3" rel="Chapter" title="2.5.3.3 Authorization Server pulls Claim from local user store"/>
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 IANA Considerations"/>
<link href="#rfc.section.2.7" rel="Chapter" title="2.7 Acknowledgments"/>
<link href="#rfc.section.2.8" rel="Chapter" title="2.8 Issues"/>
<link href="#rfc.references" rel="Chapter" title="3 References"/>
<link href="#rfc.references.1" rel="Chapter" title="3.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="3.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Document History"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.5 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Catalano, D., Ed. and M. Machulak" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-catalano-uma-claim-framework-00b" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-4-24" />
  <meta name="dct.abstract" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy. This specification defines a generic framework for building UMA claim profiles that can be used by client applications to obtain the necessary authorization from authorization servers to access protected resources on resource servers." />
  <meta name="description" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy. This specification defines a generic framework for building UMA claim profiles that can be used by client applications to obtain the necessary authorization from authorization servers to access protected resources on resource servers." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">D. Catalano, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Oracle</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">M. Machulak</td>
</tr>
<tr>
  <td class="left">Expires: October 26, 2014</td>
  <td class="right">Cloud Identity</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">April 24, 2014</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Generic Framework for UMA Claim Profiles<br />
  <span class="filename">draft-catalano-uma-claim-framework-00b</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy. This specification defines a generic framework for building UMA claim profiles that can be used by client applications to obtain the necessary authorization from authorization servers to access protected resources on resource servers.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 26, 2014.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a></li>
<li>2.   <a href="#rfc.section.2">Generic Framework for Claim Profiling</a></li>
<li>2.1.   <a href="#rfc.section.2.1">Client provides custom user attributes</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Client Acts as SAML Assertion Conveyor</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Client Acts as OpenID Connect Claims Conveyor</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Hybrid Approach: Client Acts as Custom Claims Conveyor and OpenID Connect Claims Conveyor</a></li>
<li>2.5.   <a href="#rfc.section.2.5">Client Redirects Requesting Party to AS</a></li>
<li>2.5.1.   <a href="#rfc.section.2.5.1">Requesting Party Claims Endpoint</a></li>
<li>2.5.2.   <a href="#rfc.section.2.5.2">Message Flow</a></li>
<li>2.5.3.   <a href="#rfc.section.2.5.3">Examples</a></li>
<li>2.5.3.1.   <a href="#rfc.section.2.5.3.1">Authorization Server Acts as OpenID Connect Relying Party</a></li>
<li>2.5.3.2.   <a href="#rfc.section.2.5.3.2">Authorization Server Acts as SAML Relying Party</a></li>
<li>2.5.3.3.   <a href="#rfc.section.2.5.3.3">Authorization Server pulls Claim from local user store</a></li>
<li>2.6.   <a href="#rfc.section.2.6">IANA Considerations</a></li>
<li>2.7.   <a href="#rfc.section.2.7">Acknowledgments</a></li>
<li>2.8.   <a href="#rfc.section.2.8">Issues</a></li>
<li>3.   <a href="#rfc.references">References</a></li>
<li>3.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>3.2.   <a href="#rfc.references.2">Informative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Document History</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">User-Managed Access <a href="#UMA">[UMA]</a> is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy. This specification defines a generic framework for building UMA claim profiles that can be used by client applications to obtain the necessary authorization from authorization servers to access protected resources on resource servers.</p>
<p id="rfc.section.1.p.2">Using this framework, new profiles can be easily added to meet requirements of particular deployments of UMA. Profiles built on this framework will share certain interoperability and ease of development properties (of both authorization servers and clients). This specification also provides some profiles that build on the framework.  Third-party profiles can build on the framework directly or on these sample profiles, as they wish.</p>
<p id="rfc.section.1.p.3">The framework introduces different interaction patterns that the client and authorization server can use, and different roles they can play, in order to gather claims about the requesting party:</p>

<ul>
  <li>The <em>delivery</em> interaction pattern leverages a <em>claims-aware client</em> that is able to deliver claims about the requesting party (or information about how to get claims) directly to the authorization server. The information delivered can be an identity or claims token, data that aids in discovery of a claims endpoint, etc. The authorization server then plays the role of a <em>claims receiver</em> (and/or activates a <em>claims connector</em> based on the information, for gathering claims itself without requesting party involvement).</li>
  <li>The <em>redirect</em> pattern assumes a <em>claims-unaware client</em> whose only option (other than failing entirely) is to redirect the end-user requesting party to the authorization server. On receiving the end user, the authorization server activates a <em>claims connector</em> for gathering the necessary claims with the user's involvement, using any method or combination of methods. In this role, the authorization server may be a relying party in a federated identity interaction, or it may connect to a directory or other user repository. After the claims-gathering process, the authorization server redirects the user back to the client.</li>
</ul>
<p id="rfc.section.1.p.4">The profiles defined based on both interaction patterns are as follows:</p>

<ul>
  <li>Delivery:<ul><li>Client delivers a SAML assertion to the authorization server</li><li>Client delivers OpenID Connect user claims to the authorization server</li><li>Client delivers custom user claims to the authorization server</li><li>Client delivers custom and OpenID Connect user claims to the authorization server</li></ul></li>
  <li>Redirect:<ul><li>Client redirects end-user requesting party to the authorization server</li></ul></li>
</ul>
<p id="rfc.section.1.p.5">In all cases, it is assumed that the authorization server evaluates the resource owner's policy for a particular resource set based, at least in part, on the supplied claims. Third parties have the opportunity to further profile the profiles for greater interoperability in particular deployments. An authorization server MAY support any claim profiles, and SHOULD advertise its conformance to those profiles in its configuration data. </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Notational Conventions</h1>
<p id="rfc.section.1.1.p.1">The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Unless otherwise noted, all the protocol properties and values are case sensitive.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#framework" id="framework">Generic Framework for Claim Profiling</a></h1>
<p id="rfc.section.2.p.1">(ISSUE: Put stuff about how need_claims returns significant hints here.)</p>
<p id="rfc.section.2.p.2">An authorization server has an opportunity, when it returns a "need_claims" response to a client asking for authorization, to provide further instructions and hints to the client in this response. </p>
<p id="rfc.section.2.p.3">In order to support delivery-pattern claim profiles, the authorization request endpoint in the authorization API presented by the authorization server is extended to accept JSON-encoded claims-related data in the body of the request. Along with the "rpt" and "ticket" properties that already need to be provided, a "claims" property appears in addition.</p>
<p id="rfc.section.2.p.4">Common message flow:</p>
<p>1. The client sends the claims type and its claims directly to the AS</p>
<pre>POST /rpt_authorization HTTP/1.1
        Host: www.nuveam.com
        Authorization: Bearer jwfLG53^sad$#f
        ...
            
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
        {
            "type": "CLAIM_TYPE_AS_STRING",
            "value": {SPECIFIC_SET_OF_CLAIMS_AS_JSON_OBJECT}
        }
    ]
}
        </pre>
<p id="rfc.section.2.p.5">Importantly, the claims MUST be an array of JSON objects. The type field MUST have a String value indicating the type of claims-related data, while the value field MUST be a JSON object specific to that type of claims-related data.</p>
<p>2. The authorization server informs the client that authorization data has been added</p>
<pre>HTTP/1.1 201 Created
    Content-Type: application/json;charset=UTF-8
        
    {
        "rpt":"e6b09a4f434a6a47a65a198652df381a"
    }
    </pre>
<p>3. The authorization server informs the client that further claims should be provided to the authorization request endpoint:</p>
<pre>HTTP/1.1 403 Forbidden
Content-Type: application/json
        
{
    "need_claims":[
    {
        "type":"CLAIM_TYPE_AS_STRING",
        "name":"",
        "value":""
    }]
}
    </pre>
<p>4. The authorization server informs the client that further claims should be provided (the example below is for SAML assertion)</p>
<pre>HTTP/1.1 403 Forbidden
Content-Type: application/json
        
{
    "need_claims":[
    {
        "type":"claim-client-assertion-saml-1.0",
        "name":"",
        "value":""
    }
    ]
}
    </pre>
<p>5. The authorization server informs the client that the authorization data cannot be added.</p>
<pre>HTTP/1.1 403 Forbidden
Content-Type: application/json;charset=UTF-8
        
{
    "error":"not_authorized_permission",
    "error_description":"Authorization data cannot be added."
}
    </pre>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#client-pull-custom-attr" id="client-pull-custom-attr">Client provides custom user attributes</a></h1>
<p id="rfc.section.2.1.p.1">TYPE = "custom"</p>
<p id="rfc.section.2.1.p.2">VALUE = {custom defined}</p>
<p id="rfc.section.2.1.p.3">In the most trivial setting where the AS and the Client are collocated and have an established trust relationship (in particular, the AS trusts information that it receives from the client), then the client can be preconfigured to provide the required information to the AS based on a custom schema. We provide the most trivial example below, where the client application provides a user's identifier (in this case email) to the AS and such identifier is used for policy evaluation.</p>
<p>Example:</p>
<pre>POST /rpt_authorization HTTP/1.1
Host: www.nuveam.com
Authorization: Bearer jwfLG53^sad$#f
...
           
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
    {
        "type": "ci-nuveam-claims",
        "value": { "email": "bob@company.example.com" }
    }
    ]
}
       </pre>
<p id="rfc.section.2.1.p.4">Another example is where the client provides a richer set of attributes directly to the AS and these attributes are used for policy evaluation. Importantly, it is the AS that decides which attributes are used for policy evaluation and which are not.</p>
<p>Example:</p>
<pre>POST /rpt_authorization HTTP/1.1
Host: www.nuveam.com
Authorization: Bearer jwfLG53^sad$#f
...
        
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
        {
        "type": "ci-nuveam-claims",
        "value": { "email": "bob@gmail.com", "roles": [ "manager", "admin" ] }
        }
    ]
    
}
    </pre>
<p id="rfc.section.2.1.p.5">We provide an example of a reply below (standard UMA reply):</p>
<p>Example:</p>
<pre>HTTP/1.1 201 Created
Content-Type: application/json
        
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv2"
}
    </pre>
<p id="rfc.section.2.1.p.6">In case of custom attributes, the client does not necessarily use any specific protocol for obtaining user attributes. It can use a pre-established relationship with the AS to provide the required set of attributes.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#claims-as-saml-conveyor" id="claims-as-saml-conveyor">Client Acts as SAML Assertion Conveyor</a></h1>
<p id="rfc.section.2.2.p.1">TYPE = "claim-client-assertion-saml-1.0"</p>
<p id="rfc.section.2.2.p.2">VALUE = {base64-encoded SAML assertion}</p>
<p id="rfc.section.2.2.p.3">In this setting the AS and the Client have a pre-established trust relationship. The client may provide the AS with a SAML assertion that can be used for policy evaluation. We provide an example of the request below.</p>
<p>Example:</p>
<pre>POST /rpt_authorization HTTP/1.1
Host: www.nuveam.com
Authorization: Bearer jwfLG53^sad$#f
...
            
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
    {
        "type": "claim-client-assertion-saml-1.0",
        "value": {
        "saml_assertion": "PHNhbWxwOl...[omitted for brevity]...ZT"
        }
    }
    ]
    
}
        </pre>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#claims-as-oidc-conveyor" id="claims-as-oidc-conveyor">Client Acts as OpenID Connect Claims Conveyor</a></h1>
<p id="rfc.section.2.3.p.1">TYPE = "claim-client-claims-oidc-1.0"</p>
<p id="rfc.section.2.3.p.2">VALUE = {set of oidc reserved claims}</p>
<p id="rfc.section.2.3.p.3">In this setting the AS and the Client have a pre-established trust relationship. The client may provide the AS with a OpenID Connect user claims that can be used for policy evaluation. We provide an example of the request made by the client to the Authorization Server below.</p>
<p>Example:</p>
<pre>POST /rpt_authorization HTTP/1.1
Host: www.nuveam.com
Authorization: Bearer jwfLG53^sad$#f
...
            
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
    {
        "type": "claim-client-claims-oidc-1.0",
        "value": {
        "sub": "248289761001"
        "name": "Jane Doe",
        "given_name": "Jane",
        "family_name": "Doe",
        "email": "joedoe@example.com"
        "email_verified": true,
        }
    }
    ]    
}
        </pre>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#claims-as-custom-conveyor" id="claims-as-custom-conveyor">Hybrid Approach: Client Acts as Custom Claims Conveyor and OpenID Connect Claims Conveyor</a></h1>
<p id="rfc.section.2.4.p.1">TYPE = "custom"</p>
<p id="rfc.section.2.4.p.2">VALUE = {custom defined}</p>
<p id="rfc.section.2.4.p.3">TYPE = "claim-client-claims-oidc-1.0"</p>
<p id="rfc.section.2.4.p.4">VALUE = {set of oidc reserved claims}</p>
<p id="rfc.section.2.4.p.5">In this setting the AS and the Client have a pre-established trust relationship. The client may provide the AS with custom claims as well as with OpenID Connect user claims that can be used for policy evaluation.  We provide an example of the request below.</p>
<p>Example:</p>
<pre>POST /rpt_authorization HTTP/1.1
Host: www.nuveam.com
Authorization: Bearer jwfLG53^sad$#f
...
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claims": [
    {
        "type": "ci-nuveam-claims",
        "value": { "roles": ["manager", "admin" }
            },
    {
        "type": "claim-client-claims-oidc-1.0",
        "value": { "email": "bob@gmail.com" }
            }
    ]
}
    </pre>
<h1 id="rfc.section.2.5"><a href="#rfc.section.2.5">2.5.</a> <a href="#claims-as-redirect" id="claims-as-redirect">Client Redirects Requesting Party to AS</a></h1>
<p id="rfc.section.2.5.p.1">TYPE = "claim-client-redirect-1.0"</p>
<p id="rfc.section.2.5.p.2">VALUE = {value of the scope at AS}</p>
<p id="rfc.section.2.5.p.3">The redirect UMA profile defines a Requesting Party Claims Endpoint that the Authorization Server has to support. This endpoint is advertised in the Authorisation Server Configuration Data as defined by the UMA specification <a href="#UMA">[UMA]</a>.  The requesting party claims endpoint is used by the Authorization Server to interact with the requesting party and not with the client application. The authorization server can first verify the identity of the requesting party or it may engage the requesting party in claims gathering flow. For example, the AS may decide based on the authentication process that it has enough information to evaluate a policy or it may require the requesting party to provide further claims, e.g. using an existing identity federation protocol. For example, after landing at this endpoint the requesting party may be further redirected to the source of claims (e.g. SAML IDP or the OpenID Connect Identity Provider).</p>
<h1 id="rfc.section.2.5.1"><a href="#rfc.section.2.5.1">2.5.1.</a> <a href="#claims-as-redirect-endpoint" id="claims-as-redirect-endpoint">Requesting Party Claims Endpoint</a></h1>
<p id="rfc.section.2.5.1.p.1">In redirect UMA profile, the configuration data has to be extended with the following property.</p>

<dl>
  <dt>requesting_party_claims_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the authorization server interacts with the end-user requesting party to obtain the necessary user-claims that will be used during policy evaluation process.</dd>
</dl>
<p>Example of authorization server configuration extended with requesting party claims endpoint:</p>
<pre>{
"version":"1.0",
"issuer":"https://example.com",
"pat_profiles_supported":["bearer"],
"aat_profiles_supported":["bearer"],
"rpt_profiles_supported":["bearer"],
"pat_grant_types_supported":["authorization_code"],
"aat_grant_types_supported":["authorization_code"],
"claim_profiles_supported":["openid"],
"dynamic_client_endpoint":"https://as.example.com/dyn_client_reg_uri",
"token_endpoint":"https://as.example.com/token_uri",
"user_endpoint":"https://as.example.com/user_uri",
"resource_set_registration_endpoint":"https://as.example.com/rs/rsrc_uri",
"introspection_endpoint":"https://as.example.com/rs/status_uri",
"permission_registration_endpoint":"https://as.example.com/rs/perm_uri",
"rpt_endpoint":"https://as.example.com/client/rpt_uri",
"authorization_request_endpoint":"https://as.example.com/client/authz_uri",
"requesting_party_claims_endpoint":"https://as.example.com/rp/claims_uri"
}</pre>
<h1 id="rfc.section.2.5.2"><a href="#rfc.section.2.5.2">2.5.2.</a> <a href="#claims-as-redirect-flow" id="claims-as-redirect-flow">Message Flow</a></h1>
<p id="rfc.section.2.5.2.p.1">Message flow:</p>
<p>1. Client asks for new authorization data to be added to an existing RPT</p>
<pre>POST /rpt_authorization HTTP/1.1
        Host: www.nuveam.com
        Authorization: Bearer jwfLG53^sad$#f
        ...
                
        {
        "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
        "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
        }
            </pre>
<p>2. AS tells the client to redirect the user to the Requesting Party Claims Endpoint and includes the scope parameter in the value of the response</p>
<pre>HTTP/1.1 403 Forbidden
    Content-Type: application/json
            
    {
      "need_claims":[
        {
          "type":"redirect_required",
          "name":"Redirect Required",
          "value":"699faf5bf2869838e992d57756bc6f"
        }
      ]
    }
        </pre>
<p>3. Client redirects the user to the Requesting Party Claims Endpoint and includes the scope parameter in the request</p>
<pre>HTTP/1.1 302 Found
    Location: https://www.nuveam.com/uma/rp_claims?scope=699faf5bf2869838e992
    d57756bc6f&amp;redirect_uri=http%3A%2F%2Fwww.umaapp.com%%2Fredirect&amp;client_id=
    ca4453936fa5fda2110b9e589d61ab37&amp;state=32455ddsafas
    </pre>
<p id="rfc.section.2.5.2.p.2">After the user is redirected to the AS, the claims for the user are gathered according to one of the defined protocols, such as SAML, OpenID Connect or any other protocol implemented by an UMA-compliant Authorisation Server. Furthermore, the AS is free to obtain the information from a local or remote LDAP, Active Directory or any other user datastore (e.g. SQL or NoSQL-based datastore).</p>
<p>4. AS informs the client that new authorization can be added and the client is free to request a new RPT</p>
<pre>HTTP/1.1 302 Found
    Location: https://www.umaapp.com/redirect?access=granted&amp;state=32455ddsafas
          </pre>
<p>5. AS informs the client that authorization data cannot be added</p>
<pre>HTTP/1.1 302 Found
    Location: https://www.umaapp.com/redirect?access=denied&amp;state=32455ddsafas
          </pre>
<h1 id="rfc.section.2.5.3"><a href="#rfc.section.2.5.3">2.5.3.</a> <a href="#claims-as-redirect-examples" id="claims-as-redirect-examples">Examples</a></h1>
<p id="rfc.section.2.5.3.p.1">In this section, we discuss three examples:</p>

<ol>
  <li>User is redirected to an OIDC Provider;</li>
  <li>User is redirected to a SAML IDP;</li>
  <li>User's authentication is sufficient for policy evalutation.</li>
</ol>

<p> </p>
<h1 id="rfc.section.2.5.3.1"><a href="#rfc.section.2.5.3.1">2.5.3.1.</a> <a href="#claims-as-rp-oidc" id="claims-as-rp-oidc">Authorization Server Acts as OpenID Connect Relying Party</a></h1>
<p id="rfc.section.2.5.3.1.p.1">In this claim profile example, the Authorisation Server acts as an OIDC compliant RP. This flow is used in case the policies for a particular resource set use any of the existing reserved OIDC claims. Importantly, it is the AS that determines if OIDC claims should be used for policy evaluation. This information is not shared with the client application.</p>
<p id="rfc.section.2.5.3.1.p.2">During this flow the AS acts according to the OpenID Connect protocol and this is outside of the UMA specification.</p>
<h1 id="rfc.section.2.5.3.2"><a href="#rfc.section.2.5.3.2">2.5.3.2.</a> <a href="#claims-as-rp-saml" id="claims-as-rp-saml">Authorization Server Acts as SAML Relying Party</a></h1>
<p id="rfc.section.2.5.3.2.p.1">In this claim profile example, the Authorisation Server acts as an SAML compliant Service Provider. This flow is used in case the policies for a particular resource set require the use of the SAML protocol.  Importantly, it is the AS that determines if the SAML protocol should be used for policy evaluation. This information is not shared with the client application.</p>
<p id="rfc.section.2.5.3.2.p.2">During this flow the AS acts according to the SAML protocol and this is outside of the UMA specification.</p>
<h1 id="rfc.section.2.5.3.3"><a href="#rfc.section.2.5.3.3">2.5.3.3.</a> <a href="#claims-from-local-datastore" id="claims-from-local-datastore">Authorization Server pulls Claim from local user store</a></h1>
<p id="rfc.section.2.5.3.3.p.1">In this claim profile example and after successful authentication of the RP, the AS can pull the required user attributes from a local user datastore (e.g. LDAP, Active Directory, and other SQL and NoSQL-datastores).  This information can be used for policy evaluation.</p>
<h1 id="rfc.section.2.6"><a href="#rfc.section.2.6">2.6.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.2.6.p.1">This document makes no request of IANA.</p>
<h1 id="rfc.section.2.7"><a href="#rfc.section.2.7">2.7.</a> <a href="#Acknowledgments" id="Acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.2.7.p.1">The current editor of this specification is Domenico Catalano of Oracle. The following people are co-authors:</p>

<ul>
  <li>Maciej Machulak</li>
  <li>Thomas Hardjono</li>
  <li>Eve Maler</li>
</ul>
<p id="rfc.section.2.7.p.2">Additional contributors to this specification include the Kantara UMA Work Group participants, a list of whom can be found at <a href="#UMAnitarians">[UMAnitarians]</a>.</p>
<h1 id="rfc.section.2.8"><a href="#rfc.section.2.8">2.8.</a> Issues</h1>
<p id="rfc.section.2.8.p.1">Issues are captured at the project's GitHub site (<a href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>).</p>
<h1 id="rfc.references"><a href="#rfc.references">3.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">3.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="OAuth-threat">[OAuth-threat]</b>
      </td>
      <td class="top"><a>Lodderstedt, T.</a>, "<a href="http://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", January 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth2">[OAuth2]</b>
      </td>
      <td class="top"><a title="IETF">Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OIDCCore">[OIDCCore]</b>
      </td>
      <td class="top"><a>Sakimura, N.</a>, "<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>", December 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMA">[UMA]</b>
      </td>
      <td class="top"><a title="IETF">Hardjono, T.</a>, "<a href="http://tools.ietf.org/html/draft-hardjono-oauth-umacore">User-Managed Access (UMA) Profile of OAuth 2.0</a>", December 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMA-obligations">[UMA-obligations]</b>
      </td>
      <td class="top"><a>Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">Binding Obligations on UMA Participants</a>", January 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">3.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="UMAnitarians">[UMAnitarians]</b>
      </td>
      <td class="top"><a title="Maler">Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">UMA Participant Roster</a>", April 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#History" id="History">Document History</a></h1>
<p id="rfc.section.A.p.1">NOTE: To be removed by RFC editor before publication as an RFC.</p>
<p id="rfc.section.A.p.2">See <a href="http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol">http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol</a> for a list of code-breaking and other major changes made to this specification at various revision points.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Domenico Catalano</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Catalano</span>
	  </span>
	</span>
	<span class="org vcardline">Oracle</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:domenico.catalano@oracle.com">domenico.catalano@oracle.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maciej Machulak</span> 
	  <span class="n hidden">
		<span class="family-name">Machulak</span>
	  </span>
	</span>
	<span class="org vcardline">Cloud Identity</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maciej.machulak@cloudidentity.co.uk">maciej.machulak@cloudidentity.co.uk</a></span>

  </address>
</div>

</body>
</html>
